/*
    This file describes the data structures and format employed for the storing 
    of compiled bytecode and configurations for the echidna IEC 61131-3 virtual 
    machine. The Google Protocol Buffers binary format generated by this message 
    definition is subsequent written in an Intel HEX file format.
*/

message Index {

  required int32 Lower = 1;
  required int32 Upper = 2;
}

message Value {

  required uint32 Type = 1;
  /* reserved 2; */
  /* reserved "Cast"; */
  /* optional uint32 Cast = 2 */
  required int32 Length = 3;
  required uint32 Flags = 4;
  optional bytes Maximum = 5;
  optional bytes Minimum = 6;
  required bytes Value = 7;
  optional bytes Meta = 8;
  optional Index Array = 9;
}

message Symbol {

  required uint32 Id = 1;
  required uint32 Offset = 2;
  required Value Value = 3;
  optional string Name = 4;
  optional string POU = 5;
  optional string Resource = 6;
  optional string Configuration = 7;
}

message POU {

  required string Name = 1;
  required uint32 Type = 2;
  required bytes Code = 3;
}

message Program {

  required string Name = 1;
  required string POU = 2;
  optional string Task = 3;
}

message Task {
  
  required string Name = 1;
  required uint32 Priority = 2;
  /* Task.Interval = Symbol.Id */
  optional uint32 Interval = 3;
  /* Task.Single = Symbol.Id */
  optional uint32 Single = 4;
  repeated Program Program = 5;
}

message Resource {

  required string Name = 1;
  optional string Type = 2;
  repeated Task Task = 3;
  repeated Program Program = 4;
}

message Configuration {

  required string Name = 1;
  repeated Resource Resource = 2;
}

message File {
  required uint32 Magic = 1 [default = 61131];
  required uint32 Format = 2 [default = 0];
  repeated Symbol Symbols = 3;
  repeated POU POUs = 4;
  repeated Configuration Configurations = 5;
}

